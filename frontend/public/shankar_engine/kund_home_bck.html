<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kundali Chart - Nirvana Astro</title>
  <link rel="icon" type="image/x-icon" href="img/logo.png" />
  <link rel="stylesheet" href="css/index.css" />
  <script src="ephemeris/index.js"></script>
  <script src="ephemeris/common.js"></script>
  <script src="ephemeris/load.js"></script>
  <script src="ephemeris/astronomy/index.js"></script>
  <script src="ephemeris/astronomy/moshier/index.js"></script>
  <script src="ephemeris/astronomy/moshier/constant.js"></script>
  <script src="ephemeris/astronomy/moshier/julian.js"></script>
  <script src="ephemeris/astronomy/moshier/delta.js"></script>
  <script src="ephemeris/astronomy/moshier/epsilon.js"></script>
  <script src="ephemeris/astronomy/moshier/lonlat.js"></script>
  <script src="ephemeris/astronomy/moshier/gplan.js"></script>
  <script src="ephemeris/astronomy/moshier/precess.js"></script>
  <script src="ephemeris/astronomy/moshier/util.js"></script>
  <script src="ephemeris/astronomy/moshier/kepler.js"></script>
  <script src="ephemeris/astronomy/moshier/body.js"></script>
  <script src="ephemeris/astronomy/moshier/sun.js"></script>
  <script src="ephemeris/astronomy/moshier/aberration.js"></script>
  <script src="ephemeris/astronomy/moshier/altaz.js"></script>
  <script src="ephemeris/astronomy/moshier/constellation.js"></script>
  <script src="ephemeris/astronomy/moshier/deflection.js"></script>
  <script src="ephemeris/astronomy/moshier/diurnal.js"></script>
  <script src="ephemeris/astronomy/moshier/fk4fk5.js"></script>
  <script src="ephemeris/astronomy/moshier/light.js"></script>
  <script src="ephemeris/astronomy/moshier/moon.js"></script>
  <script src="ephemeris/astronomy/moshier/nutation.js"></script>
  <script src="ephemeris/astronomy/moshier/planet.js"></script>
  <script src="ephemeris/astronomy/moshier/refraction.js"></script>
  <script src="ephemeris/astronomy/moshier/siderial.js"></script>
  <script src="ephemeris/astronomy/moshier/star.js"></script>
  <script src="ephemeris/astronomy/moshier/transit.js"></script>
  <script src="ephemeris/astronomy/moshier/vearth.js"></script>
  <script src="ephemeris/astronomy/moshier/processor.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/index.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/mercury.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/venus.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/earth.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/moonlr.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/moonlat.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/mars.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/jupiter.js"></script>
  <script src="ephemeris/astronomy/moshier/plan404/saturn.js"></script>
  <script src="ephemeris/shortcut.js"></script>
  <script src="sjp.js"></script>
  <script src="jyotish.js"></script>
  <script src="kcd.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    body {
      background: #f6faf7;
      color: #222;
      font-family: 'Segoe UI', 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      min-width: 100vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .astro-title {
      font-size: 2.2em;
      text-align: center;
      margin: 32px 0 18px 0;
      color: #219150;
      font-weight: bold;
      letter-spacing: 0.5px;
      text-shadow: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5em;
    }
    .astro-title .cosmos-emoji {
      font-size: 1.3em;
      margin: 0 0.2em;
    }
    .astro-chart-container {
      width: 100%;
      max-width: 900px;
      min-height: 600px;
      max-height: 1200px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 24px #b2dfdb44;
      border: 1.5px solid #2ecc40;
      padding: 32px 36px 32px 36px;
      color: #222;
      font-size: 1.15em;
      word-break: break-word;
      overflow-y: auto;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin: 24px 0;
      background: #f6faf7;
      border-radius: 10px;
      box-shadow: 0 2px 8px #b2dfdb44;
      border: 1.5px solid #2ecc40;
      overflow: hidden;
    }
    th, td {
      padding: 14px 10px;
      border: 1px solid #2ecc40;
      color: #222;
      font-size: 1.08em;
      text-align: center;
      background: #fff;
    }
    th {
      background: #e8f5e9;
      color: #219150;
      font-weight: bold;
      font-size: 1.13em;
      letter-spacing: 0.5px;
      text-shadow: none;
    }
    tr:nth-child(even) td {
      background: #f6faf7;
    }
    tr:nth-child(odd) td {
      background: #fff;
    }
    .cosmos-banner, .section-title {
      text-align: center;
      font-size: 1.25em;
      margin: 28px 0 12px 0;
      color: #219150;
      font-weight: bold;
      letter-spacing: 1px;
      text-shadow: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5em;
    }
    .cosmos-banner .cosmos-emoji, .section-title .cosmos-emoji {
      font-size: 1.3em;
      margin: 0 0.2em;
    }
    .astro-chart-container input[type="submit"],
    .astro-chart-container button[type="button"] {
      background: #2ecc40;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 24px;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      box-shadow: 0 2px 8px #b2dfdb44;
      margin-top: 8px;
      transition: background 0.2s;
    }
    .astro-chart-container input[type="submit"]:hover,
    .astro-chart-container button[type="button"]:hover {
      background: #219150;
    }
    @media (max-width: 950px) {
      .astro-chart-container {
        max-width: 98vw;
        padding: 18px 2vw 18px 2vw;
      }
      .astro-title {
        font-size: 1.3em;
      }
      th, td {
        font-size: 0.98em;
        padding: 7px 4px;
      }
    }
    @media (max-width: 600px) {
      .astro-chart-container {
        max-width: 100vw;
        min-width: 100vw;
        border-radius: 0;
        padding: 8px 2vw 18px 2vw;
        min-height: 100vh;
        max-height: 932px;
      }
      .astro-title {
        font-size: 1.1em;
      }
      th, td {
        font-size: 0.98em;
        padding: 7px 4px;
      }
    }
    .astro-chart-container > *:not(:last-child) {
      margin-bottom: 24px;
    }
    .ad-left, .ad-right {
      position: fixed;
      top: 0;
      width: 260px;
      height: 100vh;
      background: #fffbe7;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      font-size: 1.1em;
      color: #bfa600;
      font-weight: bold;
      letter-spacing: 1px;
      border-right: 2px solid #ffe066;
      pointer-events: auto;
      padding-top: 32px;
      gap: 18px;
      box-shadow: 2px 0 16px #ffe06644;
    }
    .ad-left {
      left: 0;
      border-radius: 0 60px 60px 0;
      border-right: 2px solid #ffe066;
    }
    .ad-right {
      right: 0;
      border-radius: 60px 0 0 60px;
      border-left: 2px solid #ffe066;
    }
    .ad-section {
      width: 220px;
      min-height: 120px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px #ffe06644;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 12px 10px 10px 10px;
      border: 1.5px solid #ffe066;
      text-align: center;
      transition: box-shadow 0.2s;
    }
    .ad-section img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 8px;
      box-shadow: 0 1px 6px #ffe06633;
    }
    .ad-section-title {
      font-size: 1.08em;
      color: #bfa600;
      font-weight: bold;
      margin-bottom: 4px;
    }
    .ad-section-desc {
      font-size: 0.98em;
      color: #888;
      font-weight: normal;
    }
    @media (max-width: 1400px) {
      .astro-chart-container {
        margin-left: 140px;
        margin-right: 140px;
      }
      .ad-left, .ad-right {
        width: 120px;
      }
      .ad-section {
        width: 100px;
        min-height: 80px;
        padding: 8px 4px 8px 4px;
      }
      .ad-section img {
        width: 48px;
        height: 48px;
      }
    }
    @media (max-width: 1200px) {
      .ad-left, .ad-right {
        width: 60px;
        font-size: 0.9em;
      }
      .ad-section {
        width: 60px;
        min-height: 40px;
        padding: 4px 2px 4px 2px;
      }
      .ad-section img {
        width: 28px;
        height: 28px;
      }
    }
    @media (max-width: 950px) {
      .ad-left, .ad-right {
        display: none;
      }
      .astro-chart-container {
        margin-left: 0 !important;
        margin-right: 0 !important;
      }
    }
    .astro-chart-container {
      margin-left: 280px;
      margin-right: 280px;
    }
  </style>
</head>
<body>
  <div class="ad-left" id="ad-left"></div>
  <div class="ad-right" id="ad-right"></div>
  <div class="astro-title"><span class="cosmos-emoji">üåå‚ú®ü™ê</span> Kundali Chart & Panchanga <span class="cosmos-emoji">üåô‚≠êÔ∏è‚ú®</span></div>
  <div class="astro-chart-container" id="kundali-output"></div>
  <!-- Floating Flag Button -->
  <div id="flag-fab" style="position:fixed;bottom:24px;right:24px;z-index:9999;cursor:pointer;background:#fff;border-radius:50%;box-shadow:0 2px 8px #8884;width:56px;height:56px;display:flex;align-items:center;justify-content:center;">
    <img src="https://cdn.jsdelivr.net/npm/flag-icons/flags/4x3/gb.svg" alt="Translate" style="width:32px;height:32px;" id="flag-current">
  </div>
  <!-- Language Popup -->
  <div id="flag-popup" style="display:none;position:fixed;bottom:90px;right:24px;z-index:10000;background:#fff;border-radius:12px;box-shadow:0 2px 16px #8888;padding:18px 18px 10px 18px;min-width:220px;">
    <div style="font-weight:bold;margin-bottom:10px;">Translate</div>
    <div id="google_translate_element"></div>
    <div style="font-size:0.95em;color:#888;margin-top:8px;">Select language above</div>
  </div>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  <script>
    // Parse query params
    function getQueryParams() {
      const params = {};
      window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str,key,value) {
        params[key] = decodeURIComponent(value);
      });
      return params;
    }

    // --- DYNAMIC ADS LOGIC ---
    const defaultAds = [
      {
        title: 'Learn Vedic Astrology',
        desc: 'Free open-source resources for beginners.',
        img: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80',
        url: ''
      },
      {
        title: 'Zodiac Signs Explained',
        desc: 'Discover your Rashi and Nakshatra.',
        img: 'https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80',
        url: ''
      },
      {
        title: 'Constellation Guide',
        desc: 'Explore the night sky with open data.',
        img: 'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?auto=format&fit=crop&w=400&q=80',
        url: ''
      },
      {
        title: 'Open Source Astro Tools',
        desc: 'Try free astrology calculation software.',
        img: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80',
        url: ''
      },
      {
        title: 'Daily Horoscope',
        desc: 'Get your free daily predictions online.',
        img: 'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80',
        url: ''
      },
      {
        title: 'Birth Chart Generator',
        desc: 'Create your Janma Kundali instantly.',
        img: 'https://images.unsplash.com/photo-1465101178521-c1a9136a3b99?auto=format&fit=crop&w=400&q=80',
        url: ''
      },
      {
        title: 'Astrology Community',
        desc: 'Join open forums and discussions.',
        img: 'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80',
        url: ''
      },
      {
        title: 'Open Astro Data',
        desc: 'Access free datasets for research.',
        img: 'https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80',
        url: ''
      }
    ];

    function getAds() {
      const saved = localStorage.getItem('astro_ads');
      if (saved) {
        try {
          const arr = JSON.parse(saved);
          if (Array.isArray(arr) && arr.length === 8) return arr;
        } catch {}
      }
      return defaultAds;
    }

    function renderAdAreas() {
      const ads = getAds();
      const left = document.getElementById('ad-left');
      const right = document.getElementById('ad-right');
      if (!left || !right) return;
      left.innerHTML = '';
      right.innerHTML = '';
      for (let i = 0; i < 4; ++i) {
        const ad = ads[i];
        const div = document.createElement('div');
        div.className = 'ad-section';
        div.innerHTML = `
          <img src="${ad.img}" alt="${ad.title}" style="cursor:pointer;">
          <div class="ad-section-title">${ad.title}</div>
          <div class="ad-section-desc">${ad.desc}</div>
        `;
        div.querySelector('img').onclick = function() {
          if (ad.url) window.open(ad.url, '_blank');
        };
        left.appendChild(div);
      }
      for (let i = 4; i < 8; ++i) {
        const ad = ads[i];
        const div = document.createElement('div');
        div.className = 'ad-section';
        div.innerHTML = `
          <img src="${ad.img}" alt="${ad.title}" style="cursor:pointer;">
          <div class="ad-section-title">${ad.title}</div>
          <div class="ad-section-desc">${ad.desc}</div>
        `;
        div.querySelector('img').onclick = function() {
          if (ad.url) window.open(ad.url, '_blank');
        };
        right.appendChild(div);
      }
    }
    // Ensure ads are rendered after DOM is ready (for navigation from ads.html)
    document.addEventListener('DOMContentLoaded', renderAdAreas);
    window.onload = function() {
      renderAdAreas();
      // Read params from sessionStorage instead of query params
      let params = {};
      try {
        params = JSON.parse(sessionStorage.getItem('kundali_form_data') || '{}');
      } catch (e) { params = {}; }
      // fallback to query params if sessionStorage is empty (for backward compatibility)
      if (!params || Object.keys(params).length === 0) {
        params = getQueryParams();
      }
      window.params = params;
      if (typeof doForm === 'function') {
        // Hijack document.write in doForm to render to #kundali-output
        const originalWrite = document.write;
        document.write = function(html) {
          const out = document.getElementById('kundali-output');
          if (out) out.innerHTML = html;
        };
        doForm();
        document.write = originalWrite;
      } else {
        document.getElementById('kundali-output').innerHTML = '<b>Error:</b> Chart logic not loaded.';
      }
    };
    // Google Translate Widget
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        includedLanguages: 'en,ne,hi,fi',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
        autoDisplay: false
      }, 'google_translate_element');
      // Force default to Nepali
      setTimeout(function() {
        var select = document.querySelector('select.goog-te-combo');
        if (select && select.value !== 'ne') {
          select.value = 'ne';
          select.dispatchEvent(new Event('change'));
        }
      }, 1200);
    }
    // Floating flag button logic
    const flagFab = document.getElementById('flag-fab');
    const flagPopup = document.getElementById('flag-popup');
    const flagCurrent = document.getElementById('flag-current');
    flagFab.onclick = function() {
      flagPopup.style.display = flagPopup.style.display === 'none' ? 'block' : 'none';
    };
    document.addEventListener('click', function(e) {
      if (!flagFab.contains(e.target) && !flagPopup.contains(e.target)) {
        flagPopup.style.display = 'none';
      }
    });
  </script>
</body>
</html> 